# ü§ñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É Telegram –±–æ—Ç–∞

## üìã –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ –≤ Telegram

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ @BotFather
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –í–≤–µ–¥–∏—Ç–µ –∏–º—è –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `My Task Bot`)
4. –í–≤–µ–¥–∏—Ç–µ username –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `mytaskbot`)
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (—Ñ–æ—Ä–º–∞—Ç: `123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11`)

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ —Ñ–∞–π–ª `.env`:

```bash
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–∞–º –Ω—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π URL. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **ngrok**:

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ngrok:
```bash
# Windows (—á–µ—Ä–µ–∑ Chocolatey)
choco install ngrok

# –ò–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ —Å https://ngrok.com/download
```

#### –ó–∞–ø—É—Å–∫ ngrok:
```bash
ngrok http 3000
```

–í—ã –ø–æ–ª—É—á–∏—Ç–µ URL –≤–∏–¥–∞: `https://xxxx-xxx-xxx-xxx-xxx.ngrok-free.app`

### 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd backend
npm run setup-webhook
```

–í–≤–µ–¥–∏—Ç–µ:
- Bot Token: –≤–∞—à —Ç–æ–∫–µ–Ω –æ—Ç @BotFather
- Webhook URL: `https://your-ngrok-url.ngrok-free.app/bot/webhook`

#### –í–∞—Ä–∏–∞–Ω—Ç B: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ API

```bash
curl -X POST https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook \
  -H "Content-Type: application/json" \
  -d '{"url":"https://your-ngrok-url.ngrok-free.app/bot/webhook"}'
```

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ß–µ—Ä–µ–∑ Postman –∏–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã API

**Endpoint:** `POST http://localhost:3000/bot/set-webhook`

**Body:**
```json
{
  "url": "https://your-ngrok-url.ngrok-free.app/bot/webhook"
}
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook

```bash
curl https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getWebhookInfo
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```json
{
  "ok": true,
  "result": {
    "url": "https://your-ngrok-url.ngrok-free.app/bot/webhook",
    "has_custom_certificate": false,
    "pending_update_count": 0
  }
}
```

---

## üöÄ –ó–∞–ø—É—Å–∫

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ backend:
```bash
cd backend
npm run start:dev
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):
```bash
ngrok http 3000
```

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook (—Å–º. –≤—ã—à–µ)

### 4. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`

---

## üì± –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
- `/balance` - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å
- `/tasks` - –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
- `/profile` - –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å
- `/referral` - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
- `/help` - –°–ø—Ä–∞–≤–∫–∞

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–æ—Ç–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5173
2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
   - `bot_token` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
   - `bot_username` - username –±–æ—Ç–∞ (–±–µ–∑ @)
   - `bot_welcome_message` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - `ref_bonus` - –ø—Ä–æ—Ü–µ–Ω—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞
   - `min_withdraw` - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞
   - `max_withdraw` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞

---

## üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ö–Ω–æ–ø–∫–∏" –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
2. –°–æ–∑–¥–∞–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –∫–Ω–æ–ø–æ–∫:
   - `send_message` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
   - `open_url` - –æ—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É
   - `command` - –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É

---

## üìã –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ó–∞–¥–∞–Ω–∏—è" –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ:
   - –ù–∞–∑–≤–∞–Ω–∏–µ
   - –û–ø–∏—Å–∞–Ω–∏–µ
   - –ù–∞–≥—Ä–∞–¥–∞ (min-max USDT)
   - –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –õ–∏–º–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üåê Production Deployment

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

1. **–°–µ—Ä–≤–µ—Ä —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ HTTPS)
2. **–î–æ–º–µ–Ω** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `api.yourdomain.com`)
3. **Nginx** –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
4. **PM2** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Node.js –ø—Ä–æ—Ü–µ—Å—Å–æ–º

### –ü—Ä–∏–º–µ—Ä nginx –∫–æ–Ω—Ñ–∏–≥–∞:

```nginx
server {
    listen 443 ssl;
    server_name api.yourdomain.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    location /bot/webhook {
        proxy_pass http://localhost:3000/bot/webhook;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

```bash
curl -X POST https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook \
  -H "Content-Type: application/json" \
  -d '{"url":"https://api.yourdomain.com/bot/webhook"}'
```

---

## üêõ Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend: `npm run start:dev`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook info: `/getWebhookInfo`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ ngrok –∑–∞–ø—É—â–µ–Ω
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤ `.env`

### "Conflict: terminated by other getUpdates request"

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ webhook –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å long polling. –£–¥–∞–ª–∏—Ç–µ webhook:

```bash
curl https://api.telegram.org/bot<YOUR_BOT_TOKEN>/deleteWebhook
```

–ó–∞—Ç–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

Backend –ª–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:

```
[BotService] Validating Telegram Web App data
[BotService] User 123456789 completed task abc-123 and earned 5 USDT
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook info
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã (PostgreSQL, Redis, MinIO)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª

---

**üéâ –ì–æ—Ç–æ–≤–æ! –í–∞—à –±–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!**

