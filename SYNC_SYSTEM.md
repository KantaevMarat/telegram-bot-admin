# üîÑ –°–∏—Å—Ç–µ–º–∞ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ –†–µ–∞–ª—å–Ω–æ–º –í—Ä–µ–º–µ–Ω–∏

## üìã –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã:
- **Admin Panel** (React Frontend)
- **Backend API** (NestJS)  
- **Telegram Bot** (Webhook)
- **Mini App** (Telegram WebApp)

–í—Å–µ —Ç—Ä–∏ —á–∞—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–µ–¥–∏–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL** –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ **—Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** —á–µ—Ä–µ–∑ WebSocket –∏ Redis pub/sub.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Admin Panel    ‚îÇ
‚îÇ   (React)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ WebSocket
         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                 ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Backend  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  Redis   ‚îÇ
    ‚îÇ (NestJS) ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ Pub/Sub  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                 
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Database ‚îÇ
    ‚îÇ(PostgreSQL)‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   Bot    ‚îÇ
    ‚îÇ(Telegram)‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö:

1. **–ê–¥–º–∏–Ω–∫–∞ ‚Üí Backend ‚Üí –ë–æ—Ç**
   - –ê–¥–º–∏–Ω –∏–∑–º–µ–Ω—è–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π/–∫–Ω–æ–ø–∫—É/–∑–∞–¥–∞–Ω–∏–µ
   - Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ Redis
   - –ö–µ—à –±–æ—Ç–∞ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
   - –ë–æ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ

2. **–ë–æ—Ç/Mini App ‚Üí Backend ‚Üí –ê–¥–º–∏–Ω–∫–∞**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞–Ω–∏–µ
   - Backend –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
   - –°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket
   - –ê–¥–º–∏–Ω–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ

---

## üöÄ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. **SyncService** (Backend)

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π.

**–§–∞–π–ª:** `backend/src/modules/sync/sync.service.ts`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ Redis pub/sub –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- ‚úÖ In-memory –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å TTL
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞
- ‚úÖ Event emitter –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

**API:**
```typescript
// –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è
await syncService.publish('scenarios.updated', { id, data });

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏–µ
syncService.on('scenarios.updated', (data) => {
  console.log('Scenario updated:', data);
});

// –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
syncService.setCache('key', data, ttlSeconds);
const cached = syncService.getCache('key');

// –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞
syncService.invalidateCache('key');
```

---

### 2. **SyncGateway** (Backend WebSocket)

WebSocket —Å–µ—Ä–≤–µ—Ä –¥–ª—è real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ —Å frontend.

**–§–∞–π–ª:** `backend/src/modules/sync/sync.gateway.ts`

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `ws://localhost:3000/sync`

**–°–æ–±—ã—Ç–∏—è:**
- **Client ‚Üí Server:**
  - `subscribe` - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
  - `unsubscribe` - –æ—Ç–ø–∏—Å–∫–∞ –æ—Ç —Å–æ–±—ã—Ç–∏–π
  
- **Server ‚Üí Client:**
  - `sync:event` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  - `connected` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä –ø–æ–¥–ø–∏—Å–∫–∏:**
```javascript
socket.emit('subscribe', { 
  events: ['scenarios.updated', 'buttons.created', '*'] 
});

socket.on('sync:event', (payload) => {
  console.log('Event:', payload.type, payload.data);
});
```

---

### 3. **useSync Hook** (Frontend)

React —Ö—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å WebSocket —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π.

**–§–∞–π–ª:** `frontend/src/hooks/useSync.ts`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
import { useSync, useSyncRefetch } from '../hooks/useSync';

// –í–∞—Ä–∏–∞–Ω—Ç 1: –†—É—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
const { subscribe, unsubscribe } = useSync();

useEffect(() => {
  const handler = (data) => {
    console.log('Updated:', data);
    refetch();
  };
  
  subscribe('scenarios.updated', handler);
  
  return () => unsubscribe('scenarios.updated', handler);
}, []);

// –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
const { data, refetch } = useQuery(['scenarios'], fetchScenarios);

useSyncRefetch(['scenarios.created', 'scenarios.updated', 'scenarios.deleted'], refetch);
```

---

### 4. **BotService —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º** (Backend)

Telegram –±–æ—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∫–µ—à–∞.

**–§–∞–π–ª:** `backend/src/modules/bot/bot.service.ts`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ü—Ä–∏–º–µ—Ä:**
```typescript
async onModuleInit() {
  // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–µ—à–∞
  this.syncService.on('buttons.updated', () => {
    this.syncService.invalidateCache('buttons');
  });
}

private async getMainKeyboard() {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞
  const cached = this.syncService.getCache('buttons:main_keyboard');
  if (cached) return cached;
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
  const buttons = await this.buttonRepo.find({ where: { active: true } });
  this.syncService.setCache('buttons:main_keyboard', buttons, 60);
  
  return buttons;
}
```

---

## üì° –°–æ–±—ã—Ç–∏—è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### Scenarios (–°—Ü–µ–Ω–∞—Ä–∏–∏)
- `scenarios.created` - —Å—Ü–µ–Ω–∞—Ä–∏–π —Å–æ–∑–¥–∞–Ω
- `scenarios.updated` - —Å—Ü–µ–Ω–∞—Ä–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω
- `scenarios.deleted` - —Å—Ü–µ–Ω–∞—Ä–∏–π —É–¥–∞–ª–µ–Ω

### Buttons (–ö–Ω–æ–ø–∫–∏)
- `buttons.created` - –∫–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
- `buttons.updated` - –∫–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- `buttons.deleted` - –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∞

### Tasks (–ó–∞–¥–∞–Ω–∏—è)
- `tasks.created` - –∑–∞–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ
- `tasks.updated` - –∑–∞–¥–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ
- `tasks.deleted` - –∑–∞–¥–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ

### Settings (–ù–∞—Å—Ç—Ä–æ–π–∫–∏)
- `settings.updated` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∞

### Users (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
- `users.created` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
- `users.updated` - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- `users.balance_updated` - –±–∞–ª–∞–Ω—Å –∏–∑–º–µ–Ω–µ–Ω

### Payouts (–í—ã–ø–ª–∞—Ç—ã)
- `payouts.created` - –∑–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
- `payouts.updated` - –∑–∞—è–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- `payouts.approved` - –∑–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞
- `payouts.declined` - –∑–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### Backend

**1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
```bash
cd backend
npm install socket.io @nestjs/platform-socket.io --legacy-peer-deps
```

**2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis:**
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω:
```bash
redis-cli ping
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: PONG
```

**3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```env
REDIS_HOST=localhost
REDIS_PORT=6379
```

### Frontend

**1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
```bash
cd frontend
npm install socket.io-client
```

**2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```
‚úÖ WebSocket connected: <socket-id>
üì° WebSocket server confirmed connection
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Backend –ª–æ–≥–∏
```bash
# Backend
‚úÖ Redis connected successfully
‚úÖ Subscribed to sync:* events
üì§ Publishing event: scenarios.updated
üîÑ Invalidated 2 cache entries for scenarios
```

### Frontend –ª–æ–≥–∏
```bash
# Browser Console
üîå Connecting to WebSocket: http://localhost:3000/sync
‚úÖ WebSocket connected: abc123
üì® Sync event received: scenarios.updated {...}
üîÑ Auto-refetching data due to sync event
```

### Bot –ª–æ–≥–∏
```bash
# Backend (Bot)
‚úÖ BotService subscribed to sync events
üíæ Cached: buttons:main_keyboard (TTL: 60s)
üóëÔ∏è Cache invalidated: buttons:main_keyboard
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ Admin Panel ‚Üí –°—Ü–µ–Ω–∞—Ä–∏–∏
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
3. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
4. –£–≤–∏–¥–∏—Ç–µ:
   ```
   üì® Sync event received: scenarios.created
   üîÑ Auto-refetching data
   ```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –≤ –±–æ—Ç–µ

1. –í Admin Panel –∏–∑–º–µ–Ω–∏—Ç–µ –∫–Ω–æ–ø–∫—É
2. –í Telegram –±–æ—Ç–µ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è —Å—Ä–∞–∑—É (–∏–∑-–∑–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–µ—à–∞)

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞

1. –í –±–æ—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ
2. –í Admin Panel ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
3. –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

1. **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã** - Backend + PostgreSQL
2. **Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - WebSocket –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è** - –ö–µ—à –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª–µ–Ω
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - Redis pub/sub –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
6. **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - –†–∞–±–æ—Ç–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ Redis (local-only —Ä–µ–∂–∏–º)

### üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–î–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**
  - –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å ‚Üí –∑–∞–ø—Ä–æ—Å –≤ –ë–î
  - –ê–¥–º–∏–Ω–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  - –ë–æ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ

- **–ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**
  - –ö–µ—à: 60 —Å–µ–∫ TTL
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
  - –ë–æ—Ç –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª–µ–Ω

---

## üõ†Ô∏è Troubleshooting

### WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** `‚ùå WebSocket disconnected`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω: `http://localhost:3000`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `backend/src/main.ts`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall/antivirus

### Redis –æ—à–∏–±–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** `‚ùå Failed to connect to Redis`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Redis: `redis-server`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç: `REDIS_PORT=6379`
3. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ Redis (local-only mode)

### –ö–µ—à –Ω–µ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ —Å–æ–±—ã—Ç–∏—è –≤ `bot.service.ts`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Redis pub/sub
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
- [Socket.io](https://socket.io/docs/v4/)
- [Redis Pub/Sub](https://redis.io/topics/pubsub)
- [NestJS WebSockets](https://docs.nestjs.com/websockets/gateways)
- [React Query](https://tanstack.com/query/latest)

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis
redis-cli ping
redis-cli PUBSUB CHANNELS

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π
redis-cli PSUBSCRIBE "sync:*"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket
curl -i -N -H "Connection: Upgrade" \
  -H "Upgrade: websocket" \
  http://localhost:3000/sync
```

---

## üéâ –ò—Ç–æ–≥

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É Admin Panel, Backend, Bot –∏ Mini App —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞!

**–û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
- ‚úÖ Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∞–≤—Ç–æ–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚úÖ Redis pub/sub –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
- ‚úÖ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã (Backend + PostgreSQL)
- ‚úÖ –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω–∫–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –≤ –±–æ—Ç–µ
- ‚úÖ –î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–±–Ω–æ–≤–ª—è—é—Ç –∞–¥–º–∏–Ω–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ù–µ—Ç race conditions –∏–ª–∏ –∑–∞–¥–µ—Ä–∂–µ–∫

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É! üöÄ

