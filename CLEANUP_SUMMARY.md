# üßπ –£–¥–∞–ª–µ–Ω–∏–µ —Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ - –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –æ—Ç –≤—Å–µ—Ö —Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö Telegram-–∫–æ–º–∞–Ω–¥, –∫–Ω–æ–ø–æ–∫ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–µ–π –ª–æ–≥–∏–∫–∏. –¢–µ–ø–µ—Ä—å **–≤—Å—ë —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å**.

---

## üî• –£–¥–∞–ª–µ–Ω–æ

### 1. **–•–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ `handleCommand`**
**–ë—ã–ª–æ:** –û–≥—Ä–æ–º–Ω—ã–π `switch` —Å ~150 —Å—Ç—Ä–æ–∫–∞–º–∏ —Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥:
- `/start`, `/balance`, `/tasks`, `/profile`, `/referral`, `/menu`, `/help`
- `/rank`, `/ranks`, `/info`
- `!premium_info`, `!upgrade`

**–°—Ç–∞–ª–æ:** –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–æ–ª—å–∫–æ –ë–î:
```typescript
const dbCommand = await this.commandsService.findByName(cmdName);

if (dbCommand) {
  if (dbCommand.action_type === 'built_in') {
    await this.handleBuiltInCommand(chatId, user, dbCommand.action_payload, dbCommand.response);
  } else {
    await this.handleCustomCommand(chatId, user, dbCommand);
  }
  return;
}
```

### 2. **–•–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ Reply Keyboard –∫–Ω–æ–ø–∫–∏**
**–ë—ã–ª–æ:** Fallback –∫–Ω–æ–ø–∫–∏ –≤ `handleReplyButton`:
- `'üìã –ó–∞–¥–∞–Ω–∏—è'`
- `'üí∞ –ë–∞–ª–∞–Ω—Å'`

**–°—Ç–∞–ª–æ:** –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ë–î, –±–µ–∑ fallback.

### 3. **–•–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ Inline Keyboard –∫–Ω–æ–ø–∫–∏**
**–ë—ã–ª–æ:** –•–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ callback_data –≤ `handleCallbackQuery`:
- `'tasks'`, `'balance'`, `'profile'`, `'withdraw'`, `'referral'`

**–°—Ç–∞–ª–æ:** –¢–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ callback (–¥–ª—è –∑–∞–¥–∞–Ω–∏–π) –∏ –∫–Ω–æ–ø–∫–∏ –∏–∑ –ë–î.

### 4. **Fallback –∫–Ω–æ–ø–∫–∏ –≤ `getReplyKeyboard`**
**–ë—ã–ª–æ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–ª–∏—Å—å –∫–Ω–æ–ø–∫–∏, –µ—Å–ª–∏ –ë–î –ø—É—Å—Ç–∞—è:
```typescript
keyboard.push([{ text: 'üìã –ó–∞–¥–∞–Ω–∏—è' }, { text: 'üí∞ –ë–∞–ª–∞–Ω—Å' }]);
```

**–°—Ç–∞–ª–æ:** –¢–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –ª–æ–≥:
```typescript
this.logger.warn('‚ö†Ô∏è No reply keyboard buttons configured in database.');
```

### 5. **Fallback –∫–Ω–æ–ø–∫–∏ –≤ `getMainKeyboard`**
**–ë—ã–ª–æ:** –•–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ inline –∫–Ω–æ–ø–∫–∏ + Web App –∫–Ω–æ–ø–∫–∞:
```typescript
keyboard.push([
  { text: 'üìã –ó–∞–¥–∞–Ω–∏—è', callback_data: 'tasks' },
  { text: 'üí∞ –ë–∞–ª–∞–Ω—Å', callback_data: 'balance' },
]);
keyboard.push([
  { text: 'üë§ –ü—Ä–æ—Ñ–∏–ª—å', callback_data: 'profile' },
  { text: 'üë• –†–µ—Ñ–µ—Ä–∞–ª—ã', callback_data: 'referral' },
]);
```

**–°—Ç–∞–ª–æ:** –¢–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –ª–æ–≥.

---

## ‚úÖ –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å –∞–¥–º–∏–Ω–∫–æ–π)

### 1. **–ö–æ–º–∞–Ω–¥—ã –∏–∑ –ë–î**
- ‚úÖ –í—Å–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (`/start`, `/help`, `/tasks`, etc.) - —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã - —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –∞–¥–º–∏–Ω–∫–µ
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –∑–∞–¥–∞–Ω–∏–π - –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∑–∞–¥–∞–Ω–∏—è–º –∏–∑ –ë–î

### 2. **–ö–Ω–æ–ø–∫–∏ –∏–∑ –ë–î**
- ‚úÖ Reply Keyboard –∫–Ω–æ–ø–∫–∏ - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ –∞–¥–º–∏–Ω–∫–µ (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ "–ö–Ω–æ–ø–∫–∏")
- ‚úÖ Inline Keyboard –∫–Ω–æ–ø–∫–∏ - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ –∞–¥–º–∏–Ω–∫–µ
- ‚úÖ –ö–Ω–æ–ø–∫–∏ –≤ `/start` - —Å—Ç–∞—Ç–∏—á–Ω—ã–µ inline –∫–Ω–æ–ø–∫–∏ —Å `callback_data: 'cmd_*'`, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–µ–∫—Å—Ç—ã –∏–∑ –ë–î

### 3. **–ó–∞–¥–∞–Ω–∏—è –∏–∑ –ë–î**
- ‚úÖ –í—Å–µ –∑–∞–¥–∞–Ω–∏—è —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –∑–∞–¥–∞–Ω–∏–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- ‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π —á–µ—Ä–µ–∑ callback –∫–Ω–æ–ø–∫–∏

### 4. **–°–∏—Å—Ç–µ–º–Ω—ã–µ callback (–¥–ª—è –∑–∞–¥–∞–Ω–∏–π)**
–≠—Ç–∏ callback –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –∑–∞–¥–∞–Ω–∏–π –∏ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç:
- `cmd_*` - –∫–Ω–æ–ø–∫–∏ –∏–∑ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- `my_tasks` - —Å–ø–∏—Å–æ–∫ –º–æ–∏—Ö –∑–∞–¥–∞–Ω–∏–π
- `task_*` - –¥–µ—Ç–∞–ª–∏ –∑–∞–¥–∞–Ω–∏—è
- `start_task_*` - –Ω–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
- `submit_task_*` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
- `cancel_task_*` - –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ
- `verify_*` - –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–æ–º
- `menu` - –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `noop` - –ø—É—Å—Ç–∞—è –∫–Ω–æ–ø–∫–∞ (no operation)

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤ `handleCommand` | ~170 | ~35 | **-79%** |
| Hardcoded –∫–æ–º–∞–Ω–¥ | 13 | 0 | **-100%** |
| Hardcoded –∫–Ω–æ–ø–æ–∫ | 9 | 0 | **-100%** |
| Fallback –ª–æ–≥–∏–∫–∏ | 4 –º–µ—Å—Ç–∞ | 0 | **-100%** |
| –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö callback | 5 | 0 | **-100%** |

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –æ—á–∏—Å—Ç–∫–∏:
‚ùå –ö–æ–º–∞–Ω–¥—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å (hardcode + –ë–î)  
‚ùå –ö–Ω–æ–ø–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–∏ (hardcode + –ë–î)  
‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É  
‚ùå –ö–æ–¥ –±—ã–ª —Å–ª–æ–∂–Ω—ã–º –∏ –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º  

### –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:
‚úÖ **–í—Å–µ –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –ë–î**  
‚úÖ **–í—Å–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ –∞–¥–º–∏–Ω–∫–µ**  
‚úÖ **–ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**  
‚úÖ **–ö–æ–¥ —á–∏—Å—Ç—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π**  
‚úÖ **100% —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é**  

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–∞–Ω–¥
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí —Å—Ç—Ä–∞–Ω–∏—Ü—É **"–ö–æ–º–∞–Ω–¥—ã"**
2. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (—Å –∂–µ–ª—Ç—ã–º badge)
3. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí —Å—Ç—Ä–∞–Ω–∏—Ü—É **"–ö–Ω–æ–ø–∫–∏"**
2. –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è Reply Keyboard
3. –£–∫–∞–∂–∏—Ç–µ `row` (—Ä—è–¥) –∏ `col` (–∫–æ–ª–æ–Ω–∫–∞) –¥–ª—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è
4. –í –ø–æ–ª–µ `command` —É–∫–∞–∂–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/tasks`, `/balance`)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–¥–∞–Ω–∏–π
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí —Å—Ç—Ä–∞–Ω–∏—Ü—É **"–ó–∞–¥–∞–Ω–∏—è"**
2. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è —Å –Ω—É–∂–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
3. –ó–∞–¥–∞–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ –±–æ—Ç–µ

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- **–ù–µ –æ—Å—Ç–∞–ª–æ—Å—å fallback –ª–æ–≥–∏–∫–∏** - –µ—Å–ª–∏ –ë–î –ø—É—Å—Ç–∞, –±–æ—Ç –Ω–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏
- **–î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É** - –º–∏–Ω–∏–º—É–º 2-3 –∫–Ω–æ–ø–∫–∏ –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –Ω–µ–ª—å–∑—è —É–¥–∞–ª—è—Ç—å** - –æ–Ω–∏ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
- **–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω–∫–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ** - –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞

---

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `backend/src/modules/bot/bot.service.ts` - —É–¥–∞–ª–µ–Ω–æ ~200 —Å—Ç—Ä–æ–∫ —Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

---

## üéâ –ò—Ç–æ–≥

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–µ–≥–æ –∫–æ–¥–∞. –¢–µ–ø–µ—Ä—å **–≤—Å—ë —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å**, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- üîÑ **–ü–æ–ª–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é** –º–µ–∂–¥—É –∞–¥–º–∏–Ω–∫–æ–π –∏ –±–æ—Ç–æ–º
- üé® **–ì–∏–±–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É** –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- üõ°Ô∏è **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** –∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- üì¶ **–ß–∏—Å—Ç—ã–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π** –∫–æ–¥

**–î–∞—Ç–∞ –æ—á–∏—Å—Ç–∫–∏:** 19 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç—Ä–æ–∫ —É–¥–∞–ª–µ–Ω–æ:** ~200  
**–ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ:** 100%  

